pipeline{
  agent any
  tools {
    maven 'maven3'
  }
  stages{
    stage('Maven Build'){
      steps{
        sh "mvn clean package"
      }
    }
    stage('Build Docker Image'){
      steps{
        sh "docker build -t kammana/pets-app:v2 ."
      }
    }
    
    stage('Docker Push'){
      steps{
        withCredentials([string(credentialsId: 'docker-hub', variable: 'dockerHubPwd')]) {
          sh "docker login -u kammana -p ${dockerHubPwd}"
          sh "docker push kammana/pets-app:v2"
        }
        
      }
    }
    
    stage('Deploy k8s'){
      steps{
        kubernetesDeploy configs: 'pods.yml', 
                       kubeConfig: [path: ''], 
                       kubeconfigId: 'k8s-weekend', 
                       secretName: '', 
                       ssh: [sshCredentialsId: '*', sshServer: ''], 
                       textCredentials: [
                          certificateAuthorityData: '', 
                          clientCertificateData: '', 
                          clientKeyData: '', 
                          serverUrl: 'https://']
      }
    }
  }
}
